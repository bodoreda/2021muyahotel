<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">
    <select id="selectOneMember" parameterType="m" resultType="m">
  	select
  		member_no as memberNo,
  		member_id as memberId,
  		member_pw as memberPw,
  		member_name as memberName,
  		member_phone as phone,
  		member_addr as addr,
  		member_level as memberLevel,
  		member_gender as gender,
  		member_point as memberPoint,
  		sysdate
  	from member where member_id=#{memberId} 
  	<if test="memberPw != null">  	
  	and member_pw=#{memberPw}  		
  	</if>
  </select>
  
  <select id="selectOneMemberNum" parameterType="m" resultType="m">
  	select
  		member_no as memberNo,
  		member_id as memberId,
  		member_pw as memberPw,
  		member_name as memberName,
  		member_phone as phone,
  		member_addr as addr,
  		member_level as memberLevel,
  		member_gender as gender,
  		member_point as memberPoint,
  		sysdate
  	from member where member_no=#{memberNo} 
  </select>
  
  <insert id="insertMember" parameterType="m">
  	insert into member values
  	(member_seq.nextval,#{memberId},#{memberPw},#{memberName},#{phone},#{addr},1,#{gender},default,#{memberPoint})
  </insert>
  
   <select id="searchId" parameterType="m" resultType="m">
  	select
  		member_seq.nextval,
  		member_id as memberId,
  		member_pw as memberPw,
  		member_name as memberName,
  		member_phone as phone,
  		member_addr as addr,
  		member_level as memberLevel,
  		member_gender as gender,
  		sysdate
  	from member where member_name=#{memberName} and member_phone=#{phone} 
  </select>
   <select id="searchPw" parameterType="m" resultType="m">
  	select
  		member_seq.nextval,
  		member_id as memberId,
  		member_pw as memberPw,
  		member_name as memberName,
  		member_phone as phone,
  		member_addr as addr,
  		member_level as memberLevel,
  		member_gender as gender,
  		sysdate
  	from member where member_id=#{memberId} and member_name=#{memberName} 
  </select>
  <update id="updateMember" parameterType="m">
  	update member set 
  			member_pw=#{memberPw}, 
  			member_phone=#{phone},
  			member_addr=#{addr}
  	where member_id = #{memberId}
  </update>
  <delete id="deleteMember" parameterType="string">
  	delete from member where member_id=#{memberId}
  </delete>

  <select id="selectAllMember" resultType="m">
  select
  		member_no as memberNo,
  		member_id as memberId,
  		member_pw as memberPw,
  		member_name as memberName,
  		member_phone as phone,
  		member_addr as addr,
  		member_level as memberLevel,
  		member_gender as gender,
  		member_point as memberPoint,
  		enroll_date as enrollDate 
  	from member
  </select>
  <update id="updateMemberLevel" parameterType="m">
  	update member set
  		member_level=#{memberLevel}
  		where member_no=#{memberNo}
  </update>
  <update id="updateInputPoint" parameterType="m">
  	update member set
  		member_point=member_point + #{memberPoint}
  		where member_no=#{memberNo}
  </update>
 <update id="updateGrade" parameterType="m">
 	update member set
 		member_level=#{memberLevel}
 		where member_no=#{memberNo}
 </update>
  <select id="selectOneMemberName" parameterType="m" resultType="m">
 select
  		member_name as memberName
  	from member where member_no=#{memberNo} 
 
 </select>
  
  
  <!-- DM -->
   <select id="selectDmList" parameterType="string" resultType="dm">
  	select 
  		dm_no as dmNo,
  		sender,
  		receiver,
  		dm_content as dmContent,
  		to_char(dm_time,'mm-dd hh24:mi:ss') as dmTime,
  		read_status as readStatus
  	from direct_message
  	where sender = #{memberId} or receiver = #{memberId}
  	order by dm_time desc
  </select>
  <select id="receiverList" parameterType="string" resultType="string">
  	select
  		member_id as memberId
  	from member where member_id != #{memberId}
  </select>
  <insert id="insertDm" parameterType="dm">
  	insert into direct_message values (dm_seq.nextval, #{sender},#{receiver},#{dmContent},sysdate,'N')
  </insert>
  <select id="dmCount" parameterType="string" resultType="int">
  	select count(*) from direct_message where receiver = #{memberId} and read_status = 'N' 
  </select>
  
  <delete id="deleteDm" parameterType="dm" >
  	delete from direct_message where dm_no = #{dmNo}
  </delete>
  
  <update id="updateDm" parameterType="int">
  	update direct_message set read_status = 'Y' where dm_no = #{dmNo}
  </update>
</mapper>
